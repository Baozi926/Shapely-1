// ┌────────────────────────────────────────────────────────────────────┐ \\
// │ Shapely 0.1 - JavaScript Canvas Library                          	│ \\
// ├────────────────────────────────────────────────────────────────────┤ \\
// │ Copyright © 2013 Luke Haas (http://lukehaas.me)    				│ \\
// ├────────────────────────────────────────────────────────────────────┤ \\
// │ Licensed under the MIT license.									| \\
// └────────────────────────────────────────────────────────────────────┘ \\


(function(e,t){function o(e,t){var n=r.exec(e),i=ret=[],s=0,o;if(n[3]&&t.getElementsByClassName){i=[].slice.call(t.getElementsByClassName(n[3]),0)}else if(n[2]){i=[].slice.call(t.getElementsByTagName(e),0)}s=i.length;while(s--){try{o=i[s].getContext("2d");ret.push(o)}catch(u){}}return ret}function u(e,n){var r=n.length,i=e.length,s=0;if(typeof r==="number"){for(;s<r;s++){e[i++]=n[s]}}else{while(n[s]!==t){e[i++]=n[s++]}}e.length=i;return e}function a(e){var t;if(e.substr(0,3)=="rgb"){e=e.match(/[1-9]+/g);t={r:e[0],g:[1],b:[2]}}else{e=e.replace(/#/,"");var n=parseInt(e,16);t={r:n>>16&255,g:n>>8&255,b:n&255}}return t}function f(){this.x=0;this.y=0;this.kappa=.5522847498;this.radian=.01745329251;this.alpha=.6283185307179586;this.width=1;this.height=1;this.sides=1;this.dashWidth=10;this.dashGap=5;this.radius=0;this.style={strokeStyle:"solid",strokeWidth:1}}function c(e,t,n){if(t.shadow){e.shadowOffsetX=t.shadow.offsetX;e.shadowOffsetY=t.shadow.offsetY;e.shadowBlur=t.shadow.blur;e.shadowColor=t.shadow.color}if(t.fillGradient){t.fill=h(e,t.fillGradient)}if(t.strokeGradient){t.strokeColor=h(e,t.strokeGradient)}if(t.pattern){var r=e.createPattern(n.img,"repeat");t.fill=r}if(t.fill){e.fillStyle=t.fill;e.fill()}if(t.strokeColor){e.strokeStyle=t.strokeColor;e.lineWidth=t.strokeWidth;e.stroke()}}function h(e,t){var n,r=l=0;if(t.type=="linear"){n=e.createLinearGradient(t.positions.x1,t.positions.y1,t.positions.x2,t.positions.y2)}else if(t.type=="radial"){n=e.createRadialGradient(t.positions.x1,t.positions.y1,t.positions.r1,t.positions.x2,t.positions.y2,t.positions.r2)}l=t.colors.length;for(;r<l;r++){n.addColorStop(t.colors[r][0],t.colors[r][1])}return n}function p(e,t){var n=0,r=360/e.sides;t.moveTo(e.x,e.y);for(;n<e.sides;n++){t.lineTo(e.x+=Math.cos(r*n*e.radian)*e.radius,e.y+=Math.sin(r*n*e.radian)*e.radius)}}function d(e,t,n){e.save();if(n.rotation){e.translate(t.tranx,t.trany);e.rotate(n.rotation*t.radian)}e.beginPath();if(n.cornerRadius){e.moveTo(t.width+t.x,t.height+t.y-n.cornerRadius);e.bezierCurveTo(t.width+t.x,t.height+t.y-t.radFactor,t.width+t.x-t.radFactor,t.height+t.y,t.width+t.x-n.cornerRadius,t.height+t.y);e.lineTo(t.x+n.cornerRadius,t.height+t.y);e.bezierCurveTo(t.x+t.radFactor,t.height+t.y,t.x,t.height+t.y-t.radFactor,t.x,t.height+t.y-n.cornerRadius);e.lineTo(t.x,t.y+n.cornerRadius);e.bezierCurveTo(t.x,t.y+t.radFactor,t.x+t.radFactor,t.y,t.x+n.cornerRadius,t.y);e.lineTo(t.width+t.x-n.cornerRadius,t.y);e.bezierCurveTo(t.width+t.x-t.radFactor,t.y,t.width+t.x,t.y+t.radFactor,t.width+t.x,t.y+n.cornerRadius);e.lineTo(t.width+t.x,t.height+t.y-n.cornerRadius)}else{e.rect(t.x,t.y,t.width,t.height)}e.closePath();if(n.style){c(e,n.style,t)}e.restore()}function g(e,t,n){v[m].method(e,t,n)}var n=e.document,r=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,i="0.1",s=function(e,t){return new s.fun.init(e,t)};s.fun=s.prototype={shapely_version:i,constructor:s,init:function(e,t){var i,s,a,f;if(!e){return this}if(typeof e==="string"){i=r.exec(e);if(i&&i[1]){s=n.getElementById(i[1]);try{a=s.getContext("2d");this.length=1;this[0]=a}catch(l){}return this}else{f=o(e,n);return u(this.constructor(),f)}}return this},length:0,splice:[].slice};s.fun.init.prototype=s.fun;f.prototype.extend=function(e){var t;for(t in e){if(e.hasOwnProperty(t)){if(t=="style"||!isNaN(e[t])){this[t]=e[t]}}}if(this.radius==0){this.yrad=this.height/2;this.xrad=this.width/2}else if(e.polygon){this.yrad=this.xrad=this.radius/2}else{this.yrad=this.xrad=this.radius}if(e.circle){this.ydis=this.yrad*this.kappa;this.xdis=this.xrad*this.kappa}if(e.style){if(e.style.fill){if(e.style.opacity){this.rgb=a(e.style.fill);e.style.fill="rgba("+this.rgb.r+","+this.rgb.g+","+this.rgb.b+","+e.style.opacity+")"}}if(e.style.strokeColor){if(e.style.opacity){this.rgb=a(e.style.strokeColor);e.style.strokeColor="rgba("+this.rgb.r+","+this.rgb.g+","+this.rgb.b+","+e.style.opacity+")"}}if(e.style.pattern){this.img=new Image;this.img.src=e.style.pattern}}if(e.rotation){this.x-=this.tranx=this.x+this.xrad/2;this.y-=this.trany=this.y+this.yrad/2}if(e.cornerRadius){this.radFactor=e.cornerRadius*.449}};s.fun.circle=function(){var e=0,t=this.length,n,r,i=arguments[0]||{};i.circle=1;n=new f;n.extend(i);for(;e<t;e++){r=this[e]||{};r.save();if(i.rotation){r.translate(n.tranx,n.trany);r.rotate(i.rotation*n.radian)}r.beginPath();r.moveTo(n.width+n.x,n.yrad+n.y);r.bezierCurveTo(n.width+n.x,n.yrad+n.ydis+n.y,n.xrad+n.xdis+n.x,n.height+n.y,n.xrad+n.x,n.height+n.y);r.bezierCurveTo(n.xrad-n.xdis+n.x,n.height+n.y,n.x,n.yrad+n.ydis+n.y,n.x,n.yrad+n.y);r.bezierCurveTo(n.x,n.yrad-n.ydis+n.y,n.xrad-n.xdis+n.x,n.y,n.xrad+n.x,n.y);r.bezierCurveTo(n.xrad+n.xdis+n.x,n.y,n.width+n.x,n.yrad-n.ydis+n.y,n.width+n.x,n.yrad+n.y);r.closePath();if(i.style){c(r,i.style,n)}r.restore()}return this};s.fun.star=function(){var e=k=0,t,n,r,i=this.length,s,o,u=arguments[0]||{};s=new f;s.extend(u);t=s.radius*2;for(;e<i;e++){o=this[e]||{};o.save();if(u.rotation){o.translate(s.tranx,s.trany);o.rotate(u.rotation*s.radian)}o.beginPath();o.moveTo(s.x+t*Math.sin(s.alpha*11),s.y+t*Math.cos(s.alpha*11));for(k=11;k!=0;k--){n=k%2==1?t:s.radius;r=s.alpha*k;o.lineTo(s.x+n*Math.sin(r),s.y+n*Math.cos(r))}o.closePath();if(u.style){c(o,u.style,s)}o.restore()}return this};s.fun.triangle=function(){var e=0,t=this.length,n,r,i=arguments[0]||{};i.sides=3;i.polygon=1;n=new f;n.extend(i);for(;e<t;e++){r=this[e]||{};r.save();if(i.rotation){r.translate(n.tranx,n.trany);r.rotate(i.rotation*n.radian)}r.beginPath();p(n,r);r.closePath();if(i.style){c(r,i.style,n)}r.restore()}return this};s.fun.line=function(){var e=0,t=this.length,n,r,i,s,o,u=true;options=arguments[0]||{};s=new f;s.extend(options);s.length=Math.max(s.width,s.height);if(s.width>s.height){u=false}for(;e<t;e++){o=this[e]||{};o.save();if(options.rotation){o.translate(s.tranx,s.trany);o.rotate(options.rotation*s.radian)}o.beginPath();o.moveTo(s.x,s.y);if(options.style.strokeStyle=="dashed"){n=false;if(u){i=s.y;r=s.length+s.y;while(i<r){if(n){o.moveTo(s.x,i+=s.dashGap)}else{if((i+=s.dashWidth)>r){o.lineTo(s.x,r)}else{o.lineTo(s.x,i)}}n=!n}}else{i=s.x;r=s.length+s.x;while(i<r){if(n){o.moveTo(i+=s.dashGap,s.y)}else{if((i+=s.dashWidth)>r){o.lineTo(r,s.y)}else{o.lineTo(i,s.y)}}n=!n}}}else{if(u){o.lineTo(s.x,s.y+s.length)}else{o.lineTo(s.x+s.length,s.y)}}o.closePath();if(options.style){c(o,options.style,s)}o.restore()}return this};s.fun.polygon=function(){var e=0,t,n=this.length,r,i,s=arguments[0]||{};s.polygon=1;r=new f;r.extend(s);for(;e<n;e++){i=this[e]||{};i.save();if(s.rotation){i.translate(r.tranx,r.trany);i.rotate(s.rotation*r.radian)}i.beginPath();p(r,i);i.closePath();if(s.style){c(i,s.style,r)}i.restore()}return this};s.fun.text=function(){var e=0,t=this.length,n,r=arguments[0]||{},i=new f;i.extend(r);for(;e<t;e++){n=this[e]||{};n.save();if(r.rotation){n.translate(i.tranx,i.trany);n.rotate(r.rotation*i.radian)}if(r.align){n.textAlign=r.align}if(r.baseline){n.textBaseline=r.baseline}if(r.style){c(n,r.style,i);if(r.style.font){n.font=r.style.font}if(r.style.fill){n.fillText(r.value,i.x,i.y)}if(r.style.strokeColor){n.strokeText(r.value,i.x,i.y)}}n.restore()}return this};s.fun.image=function(){var e=0,t=this.length,n,r=new Image,i=arguments[0]||{},s=new f;s.extend(i);for(;e<t;e++){n=this[e]||{};n.save();if(i.rotation){n.translate(s.tranx,s.trany);n.rotate(i.rotation*s.radian)}if(i.src){r.src=i.src}if(i.sx&&i.sy&&i.swidth&&i.sheight){n.drawImage(r,i.sx,i.sy,i.swidth,i.sheight,s.x,s.y,s.width,s.height)}else{n.drawImage(r,s.x,s.y,s.width,s.height)}if(i.style){c(n,i.style,s)}n.restore()}return this};var v=[];s.fun.rect=s.fun.rectangle=function(){var e=0,t=this.length,n,r,i=arguments[0]||{};n=new f;n.extend(i);v.push({shape:n,method:d,options:i});for(;e<t;e++){r=this[e]||{};d(r,n,i)}return this};var m=0;s.fun.animate=function(){var e=0,t=this.length,n,r={},i=v[m].shape,s=v[m].options,o=arguments[0]||{},u=arguments[1]||1e3;callback=arguments[2]||false;o.delay=o.delay||0;if(o.x){r.x=i.x+=o.x-i.x}if(o.y){r.y=i.y+=o.y-i.y}i.extend(r);for(;e<t;e++){n=this[e]||{};g(n,i,s)}m++;return this};e.shapely=s})(window)